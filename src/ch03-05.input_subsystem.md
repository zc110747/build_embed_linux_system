# 输入子系统

在Linux系统中，输入设备数量繁多，从单个引脚的输入按键，按键矩阵，到复杂的触摸屏，鼠标，键盘。这些设备接口总类繁多(如gpio，i2c, usb)，输入信息也差别很大，例如引脚输入为I/O电平信号，按键矩阵则可能是一组电平信号，触摸屏和鼠标输入的是位置信号，键盘则输入的是对应键位的扫描码，为了统一管理这些设备，Linux系统提供input子系统，并在系统中通过/

## input

input设备的申请，配置和注册。

```c
//申请用于input设备管理的数据块
struct input_dev *devm_input_allocate_device(struct device *dev);

//设置input设备支持的能力
void input_set_capability(struct input_dev *dev, unsigned int type, unsigned int code)
/*
说明可参考文档: Documentation/input/event-codes.rst
Type支持的类型:
#define EV_SYN          0x00  -- 用于分隔事件的同步信号
#define EV_KEY          0x01  -- 按键事件，用于描述键盘，按键或者类似硬件的具体的状态改变
#define EV_REL          0x02  -- 相对坐标事件，输入相对坐标地址的改变
#define EV_ABS          0x03  -- 绝对坐标事件，输入坐标的绝对值(主要应用鼠标，触摸屏等)的改变
#define EV_MSC          0x04  -- 杂项事件，描述不符合其它类型的事件
#define EV_SW           0x05  -- 描述二进制输入开关的变化
#define EV_LED          0x11  -- 用于打开和关闭设备的LED
#define EV_SND          0x12  -- 用于输出音频
#define EV_REP          0x14  -- 支持重复触发事件(双击等)
#define EV_FF           0x15  -- 用于向输入设备发送反馈命令。
#define EV_PWR          0x16  -- 用于电源按钮和开关输入
#define EV_FF_STATUS    0x17  -- 用于接收力反馈命令

code:
按键的编码，后续input_report_key时，需要匹配对应的code, 这里列出常见的code
#EV_KEY
BTN_TOUCH   触摸事件
KEY0 ~ KEY9 数字按键
KEYA ~ KEYZ 字符按键

#EV_ABS
ABS_MT_POSITION_X       中心X位置
ABS_MT_POSITION_Y       中心Y位置
ABS_PRESSURE            按压       
*/

//在系统中注册input设备(/device/input)
int input_register_device(struct input_dev *dev)
```

## next_chapter

[返回目录](./SUMMARY.md)

直接开始下一节说明: [i2c框架说明和应用](./ch03-06.i2c_frame.md)
