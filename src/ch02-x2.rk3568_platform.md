<!-- markdownlint-disable MD033 -->
# RK3568平台说明

## 硬件信息

串口连接(TTL)，波特率: 1500000(15M)

| 引脚 | 功能说明 | 串口模块连接 |
| --- | --- | --- |
| G | GND | GND |
| T | TX | RX |
| R | RX | TX |

通过OTG连接(和USB共用一个接口，同时只能一个连接)

## firmware

| 固件名称 | 固件说明 | 来源 |
| --- | --- | --- |
| uboot.img | uboot.img是一种FIT(flattened image tree)格式镜像，它由多个镜像合并而成。<br/> 其中包括trust 镜像（ARM Trusted Firmware+OP-TEE OS）、u-boot 镜像、uboot dtb；<br/> 编译 U-Boot 时会将这些镜像打包成一个 uboot.img。<br/>uboot.img 会烧录到开发板 uboot 分区 | 编译uboot生成 |
| MiniLoaderAll.bin | 该镜像是运行在 RK3568 平台 U-Boot 之前的一段 Loader 代码（也就是比U-Boot更早阶段的 Loader）.<br/>MiniLoaderAll.bin 由 TPL 和 SPL两部分组成， TPL 用于初始化 DDR，运行在 SRAM； 而 SPL 运行在DDR，主要负责加载、 引导 uboot.img。 | 编译uboot |
| boot.img | boot.img 也是FAT32格式的镜像， 它也是由多个镜像合并而成， 其中包括内核镜像、 内核 DTB、 资源镜像 resource.img。<br/>boot.img 会烧录到开发板 boot 分区 | 编译内核 |
| parameter.txt | 一个 txt 文本文件，是 RK3568 平台的分区表文件（记录分区名以及每个分区它的起始地址、结束地址）；烧写镜像时，并不需要将parameter.txt 文件烧写到 Flash， 而是会读取它的信息去定义分区 | - |
| rootfs.img | 正常启动模式下对应的根文件系统镜像， 包含有大量的库文件、可执行文件等。rootfs.img 会烧录到开发板 rootfs 分区| 编译文件系统 |
| recovery.img | recovery 模式镜像， recovery.img 用于进入 recovery 模式， recovery.img 会烧录到开发板 recovery 分区。recovery 模式是一种用于对设备进行修复、升级更新的模式。 recovery.img 也是 FIT 格式镜像， 也是由多个镜像合并而成，其中包括ramdisk（进入 recovery 模式时挂载该根文件系统）、内核镜像（进入recovery 模式时启动该内核镜像）、 内核 DTB 以及 resource.img。 | 打包内核和文件系统 |
| misc.img | 包含 BCB（Bootloader Control Block） 信息，该镜像会烧写到开发板misc 分区。<br/>misc 分区是一个很重要的分区，其中存放了 BCB 数据块，主要用于Android/Linux 系统、 U-Boot 以及 recovery 之间的通信 | |
| userdata.img | 给用户使用，可用于存放用户的 App 或数据； 该镜像会烧写至开发板 userdata 分区，系统启动之后， 会将其挂载到/userdata 目录 | |
| oem.img | 给厂家使用，用于存放厂家的 APP 或数据，该镜像会烧写至开发板oem 分区，系统启动之后会将其挂载到/oem 目录 | - |

## atompi编译方法

对应正点原子的SDK(ATOMPI-CA1_SDK_v1.1.tar.xz)

### u-boot

```shell
cd u-boot/
./make.sh atompi-ca1
```

目录下的uboot.img和rk356x_spl_loader_v1.18.112.bin(Miniloader.bin)即为生成的u-boot文件。

### kernel

```shell
cd kernel/
./make.sh

#打包生成boot.img
if [ -d ./tmp ]; then
    sudo umount ./tmp
    rm -rf ./tmp
fi

if [ -e ./boot.img ]; then
    rm ./boot.img
fi

dd if=/dev/zero of=boot.img bs=1M count=256
mkfs.vfat -F 32 -n boot boot.img
mkdir ./tmp
sudo mount -o loop ./boot.img ./tmp
sudo rm -rf tmp_modules/lib/modules/5.10.*/build
sudo rm -rf tmp_modules/lib/modules/5.10.*/source
cd ./tmp
sudo mkdir extlinux
sudo mkdir dtbs
sudo cp ../extlinux.conf ./extlinux/
sudo cp ../kernel/arch/arm64/boot/Image ./
sudo cp ../kernel/arch/arm64/boot/dts/rockchip/rk3568-atk-atompi-ca1.dtb ./rk-kernel.dtb
sudo cp ../kernel/arch/arm64/boot/dts/rockchip/overlay/*.dtbo ./dtbs/
sudo cp -rf ../tmp_modules/lib/modules/5.10.* ./
cd ..
sudo rm -rf tmp_modules
sleep 1
sync
sleep 1
sudo umount ./tmp
sudo rm -rf ./tmp
sleep 1
sync
echo "Making bootfs finsh!"
exit_if_last_error
```

### rootfs

debain文件系统

```shell
#下载安装debain的基础库
RELEASE=bullseye TARGET=desktop ARCH=arm64 ./mk-base-debian.sh

#安装重要组件
RELEASE=bullseye ARCH=arm64 ./mk-rootfs.sh

#创建
.mk-image.sh
```

## rk3568开发板编译方法

## next_chapter

[返回目录](./SUMMARY.md)

直接开始下一章节说明: [嵌入式Linux驱动开发](./ch03-00.driver_design.md)
