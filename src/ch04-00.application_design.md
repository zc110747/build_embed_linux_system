# 应用设计说明

嵌入式开发技术总体来说是一门应用于产品的技术，无论是u-boot, 内核，文件系统，驱动，包括应用都只是系统构成的一部分。嵌入式设备可以通过检测一系列外部行为，实现具体的服务。换句话说，嵌入式系统的产品开发可以说是为了实现从数据输入(包含不限于传感器，串口，网络等)到输出(输出不限于GUI，网络，机械运动，继电器通断)的过程。在应用开发时，根据产品的需求，去分析产品输入和输出接口，这样可以更清晰的理解应用开发，如果在学习中带着这种思想，也更容易理解在做什么，为什么这么做。基于数据流动的思想去理解嵌入式产品开发，有些抽象，不过这里举个日常生活中的产品例子来帮助理解。

## 遥控器实例

遥控器就是常见的电子设备，产品功能比较单一，例如空调遥控器的目的就是实现空调的控温和工作模式，不过这只是需求，我们需要实现什么功能，下面就需要按照产品设计的角度去分析遥控器的工作模式。

1. 按键输入，遥控器是通过按键来控制空调的，没有其它输入方式，按键就是唯一的输入。
2. 控制空调输出，为了控制空调，需要有信号输出，所以给空调发送信号的发送器是一路输出。
3. 界面UI输出，需要界面显示配置和状态，屏幕UI也是一路输出。

当然上面只是设计的功能，那么对于产品就要进一步的去对应到硬件和功能上。

1. 按键输入, 根据遥控器支持的具体功能，如开关机，温度调节，工作模式调节，风速调节，定时模式等，需要多个I/O的实现，这时就需要类似3x3矩阵键盘的设计来节省I/O
2. 空调信号输出，传统空调通过红外信号通讯，支持通讯协议，因此要通过I/O实现红外协议的支持
3. 屏幕输出，选择不同接口(SPI, I2C或并口屏), 实现UI，并能够根据按键控制界面显示

对于遥控器的开发，就转换成了如下内容。

- 按键I/O检测，按键扫描驱动实现和事件触发
  - 按键的检测引脚或者中断触发(GPIO, EXTI, Interrupt)
  - 按键扫描的逻辑解析
- 红外通讯命令协议实现
  - 红外发射器管理驱动
  - 红外命令组包和发送控制
- UI界面实现，控制接口实现
  - 屏幕驱动支持(SPI/I2c/并口协议)
  - 界面UI绘制(字符库，图形库等)
- 按键事件触发对于红外命令发送命令的支持和图形重绘
  - 引脚检测转换为事件
  - 事件触发红外命令的执行
  - 事件触发图形显示的重绘

而在空调端，就需要解析红外命令，执行对应的应用调用。当然这只是产品软件开发方面的需求，对于真正的产品还需要外包装的设计，结构的设计实现，硬件电路的设计实现，给用户提供可靠，耐用，美观的服务体验。不过本系列以软件为核心，其它部分有兴趣可以自己去了解学习。上面从空调遥控器的角度去刨析了如何去理解电子产品中的嵌入式开发，虽然这个应用比较简单，但实际上也包含着产品开发的完整体系。学会如何从全局到局部，再系统的梳理。如果现在有个需求，增加通过语音或者手势检测设备去管理空调，例如智能音箱或者终端头显，看起来差别很大，其实并没有脱离上面的流程，还是按照上面的流程去解析，这里以语音控制空调为例。

1. 语音输入，智能音箱通过麦克风收集用户声音，通过云端解析成组网的操作命令
2. 控制空调输出，操作命令通过网络通知组网中的指定设备，控制空调的状态
3. 语音应答输出，控制成功后，将处理的结果通过音响告知用户，如成功，设备未找到，其它原因失败等。

对应到设计的功能，就需要以下实现。

1. 语音输入，麦克风驱动和声音采集实现，另外需要提交到服务器端解析，转变为操作命令
2. 控制空调输出，操作命令通过组网对空调设备进行管理
3. 语音应答输出，空调执行后，将处理结果返回，通知喇叭输出语音。

对于这个功能的开发，就转换成以下内容。

- 组网管理应用
  - 语音提交服务器，控制空调的命令发出都需要网络的支持，需要实现组网应用
  - 一般通过wifi进行管理，需要通过wifi模块实现或者直接使用wifi芯片开发
- 语音输入检测和服务器解析操作命令
  - 语音采集功能实现，需要模拟硬件和麦克风驱动功能实现
  - 音频数据传输到服务器并获得解析的操作命令
- 空调控制输出
  - 操作命令通过协议告知空调设备
  - 空调执行具体的操作，并将结果返回
- 语音设备应答输出
  - 语音设备将返回结果解析，转换为对应的语音
  - 根据语音，控制喇叭输出对应的音频(需要模拟硬件和喇叭驱动的支持)

可以看出，虽然语音控制看起来更复杂，从原理上也和遥控器没有太大的区别，也是采集外部的数据，解析处理后，转换为具体的动作，从而最终实现对空调的控制。数据的流转才是嵌入式设备开发的核心，理解了这一点，在复杂的设备也可以通过这种思路去拆分，清晰的一步步实现功能。

## next_chapter

[返回目录](../README.md)

直接开始下一节说明: [c语言基础语法](./ch04-01.cpp_grammar.md)
