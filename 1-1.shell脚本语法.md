
# 综述
    
&emsp;&emsp;对于完整的shell语法，是不可能一篇文章讲完，甚至一本书也远远不够，即使在嵌入式行业已经从事多年，也不是各方面都了解。因为这不仅是一套指令语法，还包含各类程序和命令功能说明，只能依靠日常使用中积累掌握，正如上所说，这里我们也按照shell命令和脚本语法两部分进行总结.<br />
这里本篇列出参考文档或者书籍.<br />
1. Linux命令行和Shell脚本编程大全(第四版)

# shell命令
&emsp;&emsp;shell命令一般指的是在命令行模式下可以执行的命令总和，包括不限于/bin/, /usr/bin/以及系统$PATH目录指定下的可执行程序或者脚本，包含内置的脚本以及用户安装的脚本或程序，其中用户安装的脚本一般位于/usr/bin目录下。因为shell每条指令都由很多的说明，完全复刻下来信息太多，意义也不大，因此这里主要列出的为内置的脚本，且为其常用的一些功能，也就是在日常使用或开发中常用的功能，如果希望更深入的了解，可通过[command] --h或man [command]进行更详细额了解。

## command_list

以A开头指令. <br />

[alias](#alias)&emsp;[apt](#apt)

以c开头指令. <br />

[cat](#cat)&emsp;[cd](#cd)&emsp;[chmod](#chmod)&emsp;[clear](#clear)&emsp;[cp](#cp)

以d开头指令. <br />

[df](#df)&emsp;[dpkg](#dpkg)&emsp;[du](#du)&emsp;

以h开头的指令.<br />

[help](#help)&emsp;

以l开头的指令.<br />

[ls](#ls)&emsp;

以m开头指令.<br />

[man](#man)&emsp;[mkdir](#mkdir)&emsp;

以r开头的指令.<br />

[rm](#rm)&emsp;

以s开头的指令.<br />

[sudo](#sudo)&emsp;

以t开头指令. <br />

[tar](#tar)&emsp;[type](#type)&emsp;

以w开头指令. <br />

[whereis](#whereis)&emsp;

以u开头指令. <br />

[ulimit](#ulimit)&emsp;

## alias

定义指令别名，常用如下:
```shell
alias ll='ls -alF'
alias cdk='cd /home/progarm/support/kernal'
```

## apt

用于安装，删除或者移除软件包的命令，也可以进行系统软件源的更新
```bash
#从软件源更新list
sudo apt-get update

#从软件源升级软件
sudo apt-get upgrade

#安装软件
sudo apt-get install [package]

#移除软件
sudo apt-get purge [package]

#检查没有依赖会自己删除
sudo apt-get autoremove

#查询已经安装的软件列表
sudo apt --installed list

#查询软件包, 支持通配
apt search [package]
apt --names-only search [package]
```

## cat

读取文件内容并显示。
```bash
#显示系统中某文件内容
cat /proc/filesystem

#连接两个文件写入另一个文件中
cat [file1] [file2]>[file3]
```

## cd

跳转到指定目录, 如果没有指定目录，则调转到主目录'/home/{author}/'
```bash
#跳转到主目录
cd

#调转到上一级目录
cd ../
```

## chmod
更改程序的访问权限，包含写，读和执行三种权限，这个十分重要，很多时候编译或者访问目录失败都是权限问题，这里先要理解文件权限的说明，通过ls -l可查看目录下所有数据(包含文件和目录)的权限。
```bash
drwxrwxrwx 1 freedom freedom  4096 Nov  6 08:41 .git/
-rwxrwxrwx 1 freedom freedom 12381 Nov  6 14:43 0.embed_linux_environment_build.md*
```
这里第一列d表示目录，-表示文件
后续分成三个组，分别是对象的属主，对象的属组和系统其它用户，每个占位3bit。
对于每个组中，r表示可读, w表示可写，x表示可执行, 下面列出常用的指令
```bash
sudo chmod 666 file2
sudo chmod 777 file1 
```

## clear

清除当前的界面显示

## cp

复制文件和目录到指定目录下。
```bash
#-r copy directories recursively
#-v explain what is being done
#-a same as -dR --preserve=all

#将本目录下所有文件复制到tmp下
cp -av * /tmp/ 
```

## df

显示当前的文件系统的占用情况。
```bash
#查询当前文件系统状态
df -h
```

## dpkg

解压安装指定deb包。
```bash
sudo dpkg -i *.deb
```

## du

查询具体文件或者目录的存储占用情况。
```bash
#查询目录下数据的存储占用情况
du -a
```

## help

查询内置命令信息的指令.
```bash
help cd
```

## ls

显示目录内容，默认显示当前目录内文件信息，不过也可以指定其它目录信息.
ls [option] [dir]
```bash
#显示详细的内部信息
ls -alF 

#递归的显示子目录的信息
ls -R
```

## man

查看命令帮助.
```bash
man ls
```

## mkdir
创建文件目录.
```bash
#在当前目录下创建指定目录
mkdir test/

#递归创建指令目录(不存在则会自动创建所有目录)
mkdir -p test/1/
```

## rm

删除文件<br />
**注意:rm文件会直接将文件删除，如果删除系统文件很可能导致无法启动，因此尽量不要root权限执行**
```bash
#删除指定文件(递归删除)
rm -rf /home/program/download/tmp/*
```

## sudo

系统管理命令，允许切换为root权限或者在root权限执行指令。
**注意:Linux默认很多情况会将关键系统文件设置为root权限才能操作，这样能避免因为无意识操作导致系统损坏，对于用户，尽量不要直接使用root账号，而是在操作时了解自己的行为，在用sudo执行命令，可以避免大部分系统损坏的情况。**
```bash
#进入root权限
sudo su

#以root权限执行命令
sudo mkdir -p /home/program
```

## tar

压缩或者解压文件，这里列出常用的命令.
```bash
#解压文件到当前目录
tar -xvf rootfs.tar.bz2

#解压文件到指定目录
tar -xvf rootfs.tat.bz2 -C /tmp/

#压缩当前目录下所有文件，打包成
tar -vcjf rootfs.tar.bz2 *

#压缩指定目录下文件
tar -vcjf rootfs.tar.bz2 /tmp/

#压缩时不指定文件夹
tar -vcjf rootfs.tar.bz2 /tmp/ --exinc
```

## type
获取命令行指令所在的目录。
```bash
#获取ls所在的目录
type ls
```

## whereis
查询二进制文件，源文件以及指令的手册文件
```bash
#查询命令和相关手册文件所在地址
whereis chmod

#只查询二进制文件
whereis -b libc.so
```

## ulimit

显示内核的配置信息，如堆栈大小
```bash
#查询内核信息
ulimit -a

#设置线程分配的栈大小
ulimit -s [stack_size]
```

# Shell语法
&emsp;&emsp;虽然日常使用linux的环境下，都是直接使用命令操作，来完成文件夹创建，文件下载，创建，处理，解压，删除等工作，不过在维护linux平台时，这类指令操作往往多且繁杂，为了统一处理这类问题，linux提供一套shell语法，可以通过可执行文件来处理这些任务，这就是常见的shell语法。

## input输入
shell脚本输入变量通过$n(n=1,2...)获取输入值
```bash
#$1, $2表示文件输入值
#如 ./test.sh test1 test2
#则 $1=test1, $2=test2 
echo "input 1 value is $1"
echo "input 2 value is $2"
```

## if语法
if语法是在linux脚本中最常见的语法，如检测某个脚本，库或目录不存在，执行其它分支，可以说是脚本中最重要的应用语法之一，其格式如下.<br />
```bash
# if [ command ]; then 
#       dothings
# elif [ command ]; then -- 可省略
#       dothings
# else
#       dothings
# fi
```
其中command主要包含如下部分.<br />
```bash
#文件或者目录判断
[ -a FILE ] 如果文件存在则为真。
[ -d FILE ] 如果文件存在且是一个目录则返回为真。
[ -e FILE ] 如果指定的文件或目录存在时返回为真。
[ -f FILE ] 如果文件存在且是一个普通文件则返回为真。
[ -r FILE ] 如果文件存在且是可读的则返回。
[ -x FILE ] 如果文件存在且是可执行的则返回为真.
[ -w FILE ] 如果文件存在且是可写的则返回为真。

# 字符串判断
[ -z STRING ] 如果STRING的长度为零则返回为真，即空是真
[ -n STRING ] 如果STRING的长度非零则返回为真，即非空是真
[ STRING1 ]　 如果字符串不为空则返回为真,与-n类似
[ STRING1 == STRING2 ] 如果两个字符串相同则返回为真
[ STRING1 != STRING2 ] 如果字符串不相同则返回为真
[ STRING1 < STRING2 ] 如果 “STRING1”字典排序在“STRING2”前面则返回为真。
[ STRING1 > STRING2 ] 如果 “STRING1”字典排序在“STRING2”后面则返回为真

# 数值判断
[ INT1 -eq INT2 ] INT1和INT2两数相等返回为真
[ INT1 -ne INT2 ] INT1和INT2两数不等返回为真
[ INT1 -gt INT2 ] INT1大于INT2返回为真
[ INT1 -ge INT2 ] INT1大于等于INT2返回为真
[ INT1 -lt INT2 ] INT1小于INT2返回为真
[ INT1 -le INT2 ] INT1小于等于INT2返回为真

#逻辑判断
[ ! EXPR ] 逻辑非，如果 EXPR 是false则返回为真。
[ EXPR1 -a EXPR2 ] 逻辑与，如果 EXPR1 and EXPR2 全真则返回为真。
[ EXPR1 -o EXPR2 ] 逻辑或，如果 EXPR1 或者 EXPR2 为真则返回为真。
[ EXPR ] || [ EXPR ] 用OR来合并两个条件
[ EXPR ] && [ EXPR ] 用AND来合并两个条件
```
基于上述命令配合，下面展示一些常用的命令组合。
```bash
#检测目录是否在PATH中
echo $PATH
if [ -d "$1" ] && echo $PATH | grep -E -q "(^|:)$1($|:)"; then
    echo "directory $1 in PATH"
else
    echo "directory $1 not in PATH"
fi
```

