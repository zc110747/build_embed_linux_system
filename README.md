# 综述

在从事嵌入式Linux开发之前，有着多年的单片机开发经验，涉及过ST，TI，NXP的芯片以及参与过基于51，Cortex-M0, Cortex-M3, Andes内核的MCU开发，包含模块验证，驱动包开发和方案实现的工作，对于硬件底层和C语言至少也算熟练工了，可是在接触Linux的学习仍然不是一帆风顺的.<br />
回想起嵌入式Linux的学习过程，前期给我最大感觉是杂乱，下载Linux环境开发，安装编译工具，编译命令以及发生错误了怎么处理，然后使用什么接口进行驱动开发，什么接口进行linux应用开发，一切顺利还好，如果中间发生了编译错误，就不知所措，十分有挫败感.不知道多少人有这种经历，下载了项目或者开源代码，按照流程却经常发生编译失败，如果会分析错误原因，去安装或者编译依赖环境还好，但这对刚入门的新人来说可以说十分困难.有Linux基础，只按照开发板官方的例程，用官方提供的环境进行编译，问题还好，但是假如想编译实现官方还未支持的应用或功能，发生缺少依赖的情况经常发生，我也是在遇到这种编译失败，搜索解决办法，安装相应支持库，积累总结记录的过程中才有了自己的一套经验，这里正是要梳理这些经验，形成方法，方便后续查找和提高.嵌入式Linux开发说到底也是一门实用的技术，因此如何结合应用去学习和应用才是最重要的，项目地址如下.<br />
```bash
git clone https://github.com/zc110747/remote_manage.git
```
本篇主要结合我的经验，讲述一个嵌入式Linux的项目从无到有的构建过程，以及其中涉及的知识点，这是我对自身开发经历的总结，可能有些纰漏或不合理的地方，也希望可以分享意见，共同提高.另外，在实际的涉及嵌入式Linux开发的项目中，往往也不是只有一个嵌入式Linux端设备, 可能还有协调了多块硬件板，作为嵌入式端的主控来共同构成功能，下面展示我参与过的嵌入式项目产品架构.<br />
**PC客户端/web端/移动端 --- 云端(可选) -- 嵌入式Linux端 --- DSP/MCU/FPGA端**
其中嵌入式Linux开发部分主要实现以下功能(可选，并非全部都是).<br />

1. 用于支持本地应用执行的硬件驱动，库以及软件的开发和移植，如gpio, i2c, spi这类驱动，以及支持加解密的ssl，图像处理的opencv，以及数据库的sqlite等.
2. 支持管理子设备(包含DSP，MCU，FPGA等)的接口驱动、通讯协议，数据管理和应用实现，其中接口包含但不限于RS485，CAN，BLE，TCP/IP等，同时协调各子模块的功能实现具体应用.
3. 提供一套UI界面用于本地界面控制或者信息展示(QT, Android App应用).
4. 局域网访问和管理的服务器，包括不限于http, snmp, telnet，rtmp协议支持和更上层基于应用, 支持本地软件访问或者web访问.
5. 用于支持远程访问和管理的网络客户端，如mqtt subcribe/publisher, tcp客户端等
6. 其它支持Linux运行和功能扩展的组件，如ssh, vnc以及支持系统运行的库或者程序.

对于嵌入式Linux开发人员来说，工作就可能涉及如下内容.
1. 建立支持开发的环境，包括不限于Linux的安装，编译工具的支持(gcc, makefile), 相应库和工具的安装.
2. 编译uboot，kernal和文件系统，完成嵌入式linux系统的bringup工作，这里涉及设备树和驱动的修改，menuconfig配置，以及编译和下载的流程，这一步主要适配RAM，ROM, 内核，时钟频率以及必要串口的改动，高端的要适配pcie等接口，完成这一步就可以系统就可以正常运行，显示和打印输出.
3. 嵌入式Linux驱动的开发，在上一步主要完成系统基础运行需要的硬件驱动，在这上面基础上扩展板级的硬件支持(可以集成到内核或者模块方式支持)，包括不限于i2c, spi, dcmi, rs485, can等，芯片厂商会提供芯片硬件访问的接口，开发者在其上实现器件相关的驱动，并与Linux内核接口结合起来，实现嵌入式Linux驱动模块.
4. 嵌入式Linux应用开发，嵌入式Linux应用开发可以理解为支持硬件接口访问的Linux应用开发，如果实现相应的库和运行环境，可以支持使用c/c++, python，node，rust，lua，Android/Java, QT/C++等进行开发，如果是Ubuntu，Debian或Android系统，则基本和Linux开发一致.不过语言只是手段，在之上构建的包含网络，UI，数据管理，子系统管理，调试和日志接口才是应用开发的的重点，这里面一部分需要自己实现，另一部分可以由开源的代码以源码或者库的方式参与，选择合适的平台和代码组合，以大幅度提升效率的.

## 开发环境构建

对于嵌入式Linux来说，项目的开发环境是在芯片开发时确定的，一般会选择某款开发板作为原型demo板(工业板卡厂商也会提供类似的开发板)，这时候编译环境是很少需要修改的，这些开发板也会提供相应的虚拟机文件，甚至一些板块直接提供配置或者编译好的Uboot，Kernal和Rootfs，开箱即用，这种情况只要嵌入式linux应用开发即可.<br />
开发环境构建其实应该是嵌入式Linux入门第一个面对的问题，不过以我的经历来说，还是在有一定基础之后再去学习，包含不限于如下知识点.<br />

1. shell命令语法
2. Linux启动加载流程
3. 系统配置文件的修改和更新
4. 编译器，库和应用程序安装

没有基础不仅修改比较困难，如果错误的使用root权限去修改，是有几率导致系统功能失效，甚至直接崩溃无法启动，严重的还需要重新安装.我在使用中也自己弄崩溃过几次虚拟机，不过如果时间充足，这部分还是可以去学习了解的，只有遇到挫折，才能找到不足，作为开发者，迟早要补足相关知识.不知道多少人遇到过相同的问题，从我开始自己构建编译环境时，遇到最多的就是编译缺少这种那种接口，执行时库版本过低，未安装某类工具的问题.每次遇到都要去搜索，安装，然后记录，如果是未安装导致的问题还好，一般sudo apt-get安装下即可，如果服务器没有支持的版本，那还要去github或者官网找到源码，编译后再以库的形式链接，本身一个库的编译，往往涉及多个库的下载编译，这在构建环境中是常态.构建编译环境是没有什么银弹的，遇到问题，解决问题，总结提高，是最好的办法，这部分可以参考如下文档.<br />
[开发环境构建](./develop_env_build.md) <br />

## 嵌入式Linux系统编译

